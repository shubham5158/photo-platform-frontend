import{r as s,j as e,L as f}from"./index-C2RzipVP.js";import{g as T,c as R,u as _,d as z}from"./Events-D9CNJsvP.js";import{a as p,t as v}from"./toast-BS29FhsU.js";const W=()=>{const[b,C]=s.useState([]),[B,j]=s.useState(!0),[i,E]=s.useState(""),[d,o]=s.useState(1),P=10,[F,w]=s.useState(1),[U,k]=s.useState(0),[D,h]=s.useState(!1),[a,n]=s.useState(null),[N,x]=s.useState(null),[l,y]=s.useState({name:"",clientName:"",clientEmail:"",gender:"men",category:"",eventDate:"",location:"",basePricePerPhoto:50,expiresAt:""}),m=s.useRef(null),r=s.useCallback(async(t={})=>{try{j(!0);const g={search:t.search??i,page:t.page??d,limit:P},u=await T(g);C(u.events||[]),k(u.total||0),o(u.page||1),w(u.totalPages||1)}catch{p("Failed to load events")}finally{j(!1)}},[i,d]);s.useEffect(()=>{r()},[]),s.useEffect(()=>{r({page:d})},[d]),s.useEffect(()=>(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{o(1),r({search:i,page:1})},400),()=>clearTimeout(m.current)),[i]);const c=t=>{y(g=>({...g,[t.target.name]:t.target.value}))},S=async()=>{try{await R({...l,basePricePerPhoto:Number(l.basePricePerPhoto)}),v("Event created & client login credentials sent via email"),y({name:"",clientName:"",clientEmail:"",gender:"men",category:"",eventDate:"",location:"",basePricePerPhoto:50,expiresAt:""}),h(!1),o(1),r({page:1})}catch{p("Event creation failed")}},A=async()=>{try{await _(a._id,a),v("Event updated successfully"),n(null),r()}catch{p("Update failed")}},L=async()=>{try{await z(N._id),v("Event deleted"),x(null),b.length===1&&d>1?o(t=>t-1):r()}catch{p("Delete failed")}};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Events"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Create events and automatically onboard clients"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{placeholder:"Search events...",value:i,onChange:t=>E(t.target.value),className:"border px-3 py-2 rounded-md text-sm w-[220px]"}),e.jsx("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-slate-900 text-white rounded-lg text-sm",children:"+ Add Event"})]})]}),e.jsx("section",{className:"bg-white rounded-xl border p-6 shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-slate-50",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Event"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Client"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Category"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-3 py-2",children:t.name}),e.jsx("td",{className:"px-3 py-2",children:t.clientName}),e.jsxs("td",{className:"px-3 py-2",children:[t.gender," / ",t.category]}),e.jsx("td",{className:"px-3 py-2",children:t.eventDate?.slice(0,10)}),e.jsxs("td",{className:"px-3 py-2 space-x-3",children:[e.jsx(f,{to:`/admin/events/${t._id}/photos`,className:"text-xs underline",children:"Photos"}),e.jsx(f,{to:`/admin/client-link/${t.galleryCode}`,className:"text-xs text-blue-600 underline",children:"QR Link"}),e.jsx("button",{onClick:()=>n(t),className:"text-xs text-green-600 underline",children:"Edit"}),e.jsx("button",{onClick:()=>x(t),className:"text-xs text-red-600 underline",children:"Delete"})]})]},t._id))})]})})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl w-full max-w-lg",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Create Event"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx("input",{name:"name",placeholder:"Event Name",value:l.name,onChange:c,className:"border px-3 py-2 rounded"}),e.jsx("input",{name:"clientName",placeholder:"Client Name",value:l.clientName,onChange:c,className:"border px-3 py-2 rounded"}),e.jsx("input",{name:"clientEmail",type:"email",placeholder:"Client Email",value:l.clientEmail,onChange:c,className:"border px-3 py-2 rounded"}),e.jsxs("select",{name:"gender",value:l.gender,onChange:c,className:"border px-3 py-2 rounded",children:[e.jsx("option",{value:"men",children:"Men"}),e.jsx("option",{value:"women",children:"Women"})]}),e.jsx("input",{name:"category",placeholder:"Category (55kg / Bikini)",value:l.category,onChange:c,className:"border px-3 py-2 rounded"}),e.jsx("input",{type:"date",name:"eventDate",value:l.eventDate,onChange:c,className:"border px-3 py-2 rounded"}),e.jsx("input",{name:"location",placeholder:"Location",value:l.location,onChange:c,className:"border px-3 py-2 rounded"}),e.jsx("input",{type:"number",name:"basePricePerPhoto",value:l.basePricePerPhoto,onChange:c,className:"border px-3 py-2 rounded"}),e.jsx("input",{type:"date",name:"expiresAt",value:l.expiresAt,onChange:c,className:"border px-3 py-2 rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-5",children:[e.jsx("button",{onClick:()=>h(!1),className:"border px-4 py-2 rounded",children:"Cancel"}),e.jsx("button",{onClick:S,className:"bg-slate-900 text-white px-4 py-2 rounded",children:"Create Event"})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-black/40 flex justify-center items-center z-50",onClick:()=>n(null),children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md p-6",onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Edit Event"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm",children:"Event Name"}),e.jsx("input",{className:"border w-full px-3 py-2 rounded",value:a.name||"",onChange:t=>n({...a,name:t.target.value})}),e.jsx("label",{className:"text-sm",children:"Client Name"}),e.jsx("input",{className:"border w-full px-3 py-2 rounded",value:a.clientName||"",onChange:t=>n({...a,clientName:t.target.value})}),e.jsx("label",{className:"text-sm",children:"Client Email"}),e.jsx("input",{type:"email",className:"border w-full px-3 py-2 rounded",value:a.clientEmail||"",onChange:t=>n({...a,clientEmail:t.target.value})}),e.jsx("label",{className:"text-sm",children:"Event Date"}),e.jsx("input",{type:"date",className:"border w-full px-3 py-2 rounded",value:a.eventDate?.slice(0,10)||"",onChange:t=>n({...a,eventDate:t.target.value})}),e.jsx("label",{className:"text-sm",children:"Location"}),e.jsx("input",{className:"border w-full px-3 py-2 rounded",value:a.location||"",onChange:t=>n({...a,location:t.target.value})}),e.jsx("label",{className:"text-sm",children:"Base Price"}),e.jsx("input",{type:"number",className:"border w-full px-3 py-2 rounded",value:a.basePricePerPhoto||"",onChange:t=>n({...a,basePricePerPhoto:Number(t.target.value)})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:()=>n(null),className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{onClick:A,className:"px-4 py-2 bg-slate-900 text-white rounded",children:"Save Changes"})]})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex justify-center items-center z-50",onClick:()=>x(null),children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-sm p-6 text-center",onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{className:"text-lg font-semibold text-red-600",children:"Delete Event?"}),e.jsx("p",{className:"text-sm text-slate-700 mb-6",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("button",{onClick:()=>x(null),className:"px-4 py-2 bg-gray-300 rounded",children:"Cancel"}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-red-600 text-white rounded",children:"Delete"})]})]})})]})};export{W as default};
