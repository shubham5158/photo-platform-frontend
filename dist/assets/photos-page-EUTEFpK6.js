import{d as p,e as U,r as l,j as e,z as i}from"./index-D-7VH6vP.js";import{a as P}from"./Events-DIWkzixD.js";import{a as d,t as S}from"./toast-BwcYeQbG.js";const E=async({eventId:s,filename:t,contentType:n})=>(await p.post("/photos/upload-url",{eventId:s,filename:t,contentType:n})).data,C=async(s,t)=>{if(!(await fetch(s,{method:"PUT",headers:{"Content-Type":t.type},body:t})).ok)throw new Error("S3 upload failed")},T=async({eventId:s,key:t})=>(await p.post("/photos/confirm",{eventId:s,key:t})).data,k=async s=>(await p.get(`/photos/events/${s}`)).data,R=()=>{const{eventId:s}=U(),[t,n]=l.useState(null),[c,y]=l.useState([]),[m,h]=l.useState([]),[u,x]=l.useState(!1),[f,w]=l.useState(null),j="db71fqi33p60s.cloudfront.net",g=async()=>{try{const a=await P(s);n(a);const o=await k(s);y(o)}catch{d("Failed to load event photos")}};l.useEffect(()=>{g()},[s]);const b=async a=>{if(a.preventDefault(),!m.length){d("Select at least 1 file");return}const o=i.loading("Uploading...");x(!0);try{for(const r of m){const{uploadUrl:v,key:N}=await E({eventId:s,filename:r.name,contentType:r.type});await C(v,r),await T({eventId:s,key:N})}i.dismiss(o),S("Photos uploaded successfully!"),await g()}catch(r){console.error(r),i.dismiss(o),d("Upload failed")}finally{x(!1),h([])}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Manage Photos"}),t&&e.jsxs("p",{className:"text-sm text-slate-600",children:[t.name," â€¢ Gallery:"," ",e.jsx("span",{className:"font-mono bg-slate-100 px-2 py-0.5 rounded",children:t.galleryCode})]})]}),e.jsx("section",{className:"bg-white border rounded-xl p-4",children:e.jsxs("form",{onSubmit:b,className:"flex flex-col md:flex-row gap-4",children:[e.jsx("input",{type:"file",multiple:!0,onChange:a=>h([...a.target.files])}),e.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-slate-900 text-white rounded",children:u?"Uploading...":"Upload"})]})}),e.jsxs("section",{className:"bg-white border rounded-xl p-4",children:[e.jsxs("h2",{className:"text-lg font-medium",children:["Photos (",c.length,")"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4",children:[c.map(a=>{const o=`https://${j}/${a.originalKey}`;return e.jsx("img",{src:o,className:"w-full h-40 object-cover"},a._id)}),!c.length&&e.jsx("p",{className:"text-sm text-slate-500",children:"No photos uploaded yet."})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center",onClick:()=>w(null),children:e.jsx("img",{src:f,className:"max-h-[90vh] max-w-[90vw] rounded shadow-2xl"})})]})};export{R as default};
