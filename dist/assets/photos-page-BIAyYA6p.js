import{d as p,e as b,r as l,j as e,z as i}from"./index-C2RzipVP.js";import{a as v}from"./Events-D9CNJsvP.js";import{a as d,t as P}from"./toast-BS29FhsU.js";const S=async({eventId:s,filename:t,contentType:n})=>(await p.post("/photos/upload-url",{eventId:s,filename:t,contentType:n})).data,C=async(s,t)=>{if(!(await fetch(s,{method:"PUT",headers:{"Content-Type":t.type},body:t})).ok)throw new Error("S3 upload failed")},R=async({eventId:s,key:t})=>(await p.post("/photos/confirm",{eventId:s,key:t})).data,_=async s=>(await p.get(`/photos/events/${s}`)).data,E="db71fqi33p60s.cloudfront.net";console.log("CLOUD_FRONT_URL =",E);const F=()=>{const{eventId:s}=b(),[t,n]=l.useState(null),[c,w]=l.useState([]),[m,h]=l.useState([]),[u,f]=l.useState(!1),[x,g]=l.useState(null),y=async()=>{try{const a=await v(s);n(a);const r=await _(s);w(r)}catch{d("Failed to load event photos")}};l.useEffect(()=>{y()},[s]);const j=async a=>{if(a.preventDefault(),!m.length){d("Select at least 1 file");return}const r=i.loading("Uploading...");f(!0);try{for(const o of m){const{uploadUrl:N,key:U}=await S({eventId:s,filename:o.name,contentType:o.type});await C(N,o),await R({eventId:s,key:U})}i.dismiss(r),P("Photos uploaded successfully!"),await y()}catch(o){console.error(o),i.dismiss(r),d("Upload failed")}finally{f(!1),h([])}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Manage Photos"}),t&&e.jsxs("p",{className:"text-sm text-slate-600",children:[t.name," â€¢ Gallery:"," ",e.jsx("span",{className:"font-mono bg-slate-100 px-2 py-0.5 rounded",children:t.galleryCode})]})]}),e.jsx("section",{className:"bg-white border rounded-xl p-4",children:e.jsxs("form",{onSubmit:j,className:"flex flex-col md:flex-row gap-4",children:[e.jsx("input",{type:"file",multiple:!0,onChange:a=>h([...a.target.files])}),e.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-slate-900 text-white rounded",children:u?"Uploading...":"Upload"})]})}),e.jsxs("section",{className:"bg-white border rounded-xl p-4",children:[e.jsxs("h2",{className:"text-lg font-medium",children:["Photos (",c.length,")"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4",children:[c.map(a=>{const o=`https://db71fqi33p60s.cloudfront.net/${a.originalKey}`;return e.jsx("div",{className:"border rounded overflow-hidden",children:e.jsx("img",{src:o,alt:"photo",className:"w-full h-40 object-cover",onClick:()=>g(o)})},a._id)}),!c.length&&e.jsx("p",{className:"text-sm text-slate-500",children:"No photos uploaded yet."})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center",onClick:()=>g(null),children:e.jsx("img",{src:x,className:"max-h-[90vh] max-w-[90vw] rounded shadow-2xl"})})]})};export{F as default};
