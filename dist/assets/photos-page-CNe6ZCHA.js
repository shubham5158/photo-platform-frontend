import{d as p,e as U,r as l,j as e,z as c}from"./index-CjWGGyKf.js";import{a as P}from"./Events-_zRMNfa-.js";import{a as d,t as S}from"./toast-pNvnD2Lz.js";const E=async({eventId:t,filename:s,contentType:n})=>(await p.post("/photos/upload-url",{eventId:t,filename:s,contentType:n})).data,k=async(t,s)=>{if(!(await fetch(t,{method:"PUT",headers:{"Content-Type":s.type},body:s})).ok)throw new Error("S3 upload failed")},C=async({eventId:t,key:s})=>(await p.post("/photos/confirm",{eventId:t,key:s})).data,T=async t=>(await p.get(`/photos/events/${t}`)).data,R=()=>{const{eventId:t}=U(),[s,n]=l.useState(null),[i,w]=l.useState([]),[h,m]=l.useState([]),[u,x]=l.useState(!1),[f,g]=l.useState(null),v="d3cdgrtnkcp7dy.cloudfront.net",y=async()=>{try{const a=await P(t);n(a);const o=await T(t);w(o)}catch{d("Failed to load event photos")}};l.useEffect(()=>{y()},[t]);const j=async a=>{if(a.preventDefault(),!h.length){d("Select at least 1 file");return}const o=c.loading("Uploading...");x(!0);try{for(const r of h){const{uploadUrl:b,key:N}=await E({eventId:t,filename:r.name,contentType:r.type});await k(b,r),await C({eventId:t,key:N})}c.dismiss(o),S("Photos uploaded successfully!"),await y()}catch(r){console.error(r),c.dismiss(o),d("Upload failed")}finally{x(!1),m([])}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Manage Photos"}),s&&e.jsxs("p",{className:"text-sm text-slate-600",children:[s.name," â€¢ Gallery:"," ",e.jsx("span",{className:"font-mono bg-slate-100 px-2 py-0.5 rounded",children:s.galleryCode})]})]}),e.jsx("section",{className:"bg-white border rounded-xl p-4",children:e.jsxs("form",{onSubmit:j,className:"flex flex-col md:flex-row gap-4",children:[e.jsx("input",{type:"file",multiple:!0,onChange:a=>m([...a.target.files])}),e.jsx("button",{type:"submit",disabled:u,className:"px-4 py-2 bg-slate-900 text-white rounded",children:u?"Uploading...":"Upload"})]})}),e.jsxs("section",{className:"bg-white border rounded-xl p-4",children:[e.jsxs("h2",{className:"text-lg font-medium",children:["Photos (",i.length,")"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4",children:[i.map(a=>{const o=`https://${v}/${a.previewKey}`;return e.jsxs("div",{className:"group relative border rounded overflow-hidden cursor-pointer",onClick:()=>g(o),children:[e.jsx("img",{src:o,alt:"photo",className:"w-full h-40 object-cover transition-transform group-hover:scale-105",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition flex items-center justify-center text-white text-sm",children:"Tap to view"})]},a._id)}),!i.length&&e.jsx("p",{className:"text-sm text-slate-500",children:"No photos uploaded yet."})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center",onClick:()=>g(null),children:e.jsx("img",{src:f,className:"max-h-[90vh] max-w-[90vw] rounded shadow-2xl"})})]})};export{R as default};
